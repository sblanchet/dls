#
# $Id$
#
# This file is part of the Data Logging Service (DLS).
#
# DLS is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later
# version.
#
# DLS is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
# details.
#
# You should have received a copy of the GNU General Public License along
# with DLS. If not, see <http://www.gnu.org/licenses/>.
#
# vim: tw=78 spelllang=en
#

Name: @PACKAGE@
Version: @VERSION@
Release: 1

Summary: Data Logging Service
License: GPL
Vendor: Ingenieurgemeinschaft IgH GmbH
Group: EtherLab
Url: http://etherlab.org/en/dls
Source: http://etherlab.org/download/dls/%{name}-%{version}.tar.bz2
BuildRoot: %_tmppath/%name-%version-root
BuildRequires: fftw3-devel
BuildRequires: fltk-devel
BuildRequires: fontconfig-devel
BuildRequires: gcc-c++
BuildRequires: libXext-devel
BuildRequires: libXft-devel
BuildRequires: libXinerama-devel
BuildRequires: libfltk1
BuildRequires: xorg-x11-proto-devel
BuildRequires: libqt4-devel

%description
DLS is a process data logging service, capable of capturing high-frequency
data over a long time and storing it in a compressed way. The aim is to allow
the user unlimited high-performance access to the data at any time. Be it a
year's overview or a small signal peak in fractions of a second.

%package -n dls-devel
Summary:        Development files for data logging service
Summary(de):    Entwickungsdateien f√ºr den DLS
Group:          EtherLab
Group(de):      EtherLab
Requires:       %name = %version

%description -n dls-devel
The %name-devel package contains the static libraries and header files
needed for development with %name.

%prep
%setup

%build
%configure
make %{?_smp_mflags}
cd widgets
qmake PREFIX=%{_prefix}
make %{?_smp_mflags}
cd ..
cd gui
qmake PREFIX=%{_prefix}
make %{?_smp_mflags}
cd ..

%install
make DESTDIR=${RPM_BUILD_ROOT} install
%if "%{_vendor}" == "suse"
install -d ${RPM_BUILD_ROOT}%{_sbindir}
ln -s %{_sysconfdir}/init.d/dls ${RPM_BUILD_ROOT}%{_sbindir}/rcdls
%endif
cd widgets
make install INSTALL_ROOT=${RPM_BUILD_ROOT}
cd ..
cd gui
make install INSTALL_ROOT=${RPM_BUILD_ROOT}
cd ..

%clean
%{__rm} -rf $RPM_BUILD_ROOT

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

%files
%defattr(-,root,root)
%doc AUTHORS ChangeLog COPYING INSTALL NEWS
%config %{_sysconfdir}/sysconfig/dls
%{_sysconfdir}/init.d/dls
%{_sysconfdir}/profile.d/dls.sh
%{_bindir}/dls*
%if "%{_vendor}" == "suse"
%{_sbindir}/rcdls
%endif
%{_datadir}/applications/*.desktop
%{_libdir}/libdls.so*
%{_libdir}/libDlsWidgets.so

%files -n dls-devel
%defattr(-,root,root,755)
%{_includedir}/DlsWidgets/Graph.h
%{_includedir}/DlsWidgets/Layer.h
%{_includedir}/DlsWidgets/Model.h
%{_includedir}/DlsWidgets/Scale.h
%{_includedir}/DlsWidgets/Section.h
%{_includedir}/DlsWidgets/Translator.h
%{_includedir}/DlsWidgets/ValueScale.h
%{_includedir}/com_channel_preset.hpp
%{_includedir}/com_exception.hpp
%{_includedir}/com_job_preset.hpp
%{_includedir}/com_time.hpp
%{_includedir}/lib_channel.hpp
%{_includedir}/lib_chunk.hpp
%{_includedir}/lib_data.hpp
%{_includedir}/lib_dir.hpp
%{_includedir}/lib_export.hpp
%{_includedir}/lib_globals.hpp
%{_includedir}/lib_job.hpp
%{_libdir}/libdls.a
%{_libdir}/libdls.la
%{_libdir}/qt4/plugins/designer/libDlsWidgets.so

%changelog
* Thu Jan 8 2013 fp@igh-essen.com
- Added some BuildRequires
* Thu Jan 26 2012 fp@igh-essen.com
- Used macro dirs
- Added .desktop files
* Mon Jan 23 2012 fp@igh-essen.com
- Improved Url, BuildRoot, Source, BuildRequires.
